{
    "id": "org.libreoffice.LibreOffice",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "25.08",
    "sdk": "org.freedesktop.Sdk",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Extension.openjdk21"
    ],
    "command": "libreoffice",
    "modules": [
        {
            "name": "openjdk",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/lib/sdk/openjdk21/install.sh"
            ]
        },
        {
            "name": "gvfs",
            "buildsystem": "meson",
            "config-opts": [
                "-Dsystemduserunitdir=no",
                "-Dtmpfilesdir=no",
                "-Dinstalled_tests=true",
                "-Dadmin=false",
                "-Dafc=false",
                "-Dafp=false",
                "-Darchive=false",
                "-Dcdda=false",
                "-Ddnssd=false",
                "-Dgoa=false",
                "-Dgoogle=false",
                "-Dgphoto2=false",
                "-Dhttp=false",
                "-Dmtp=false",
                "-Dnfs=false",
                "-Donedrive=false",
                "-Dsftp=false",
                "-Dsmb=false",
                "-Dudisks2=false",
                "-Dbluray=false",
                "-Dfuse=false",
                "-Dgcr=false",
                "-Dgcrypt=false",
                "-Dgudev=false",
                "-Dkeyring=false",
                "-Dlogind=false",
                "-Dlibusb=false",
                "-Dwsdd=false"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/gvfs/1.59/gvfs-1.59.1.tar.xz",
                    "sha256": "f582b44b949a44094cf6ed26f436ca501ec1fb62762b13f7e5e3d9d01ce94baa",
                    "x-checker-data": {
                        "type": "gnome",
                        "name": "gvfs",
                        "stable-only": true
                    }
                }
            ]
        },
        {
            "name": "krb5",
            "subdir": "src",
            "config-opts": [
                "--disable-static",
                "--disable-rpath",
                "--sbindir=/app/bin"
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "/var"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://kerberos.org/dist/krb5/1.22/krb5-1.22.2.tar.gz",
                    "sha256": "3243ffbc8ea4d4ac22ddc7dd2a1dc54c57874c40648b60ff97009763554eaf13",
                    "x-checker-data": {
                        "type": "html",
                        "url": "https://kerberos.org/dist/",
                        "version-pattern": "Kerberos V5 Release ([\\d\\.]+) - current release",
                        "url-template": "https://kerberos.org/dist/krb5/$major.$minor/krb5-$version.tar.gz"
                    }
                }
            ]
        },
        {
            "name": "libreoffice",
            "sources": [
                {
                    "type": "git",
                    "url": "https://gerrit.libreoffice.org/core",
                    "tag": "libreoffice-26.2.0.3",
                    "disable-fsckobjects": true
                },
                {
                    "type": "archive",
                    "url": "https://archive.apache.org/dist/ant/binaries/apache-ant-1.10.14-bin.tar.bz2",
                    "sha512": "05e9f786044b9ba0dcc5e2b40ed2bd4ecfb25896a453ba78e2d4df18896c6be7d1564fd615f483c90c0d26dd1e0fb507c778f0c10712818b1fc8c9acbc0a26c6",
                    "dest": "ant"
                },
                {
                    "commands": [
                        "mkdir external/tarballs"
                    ],
                    "type": "shell"
                },
                "external-tarballs.json"
            ],
            "buildsystem": "simple",
            "build-commands": [
                "./autogen.sh --prefix=/run/build/libreoffice/inst --with-distro=LibreOfficeFlatpak --with-gdrive-client-id=280867422816-9jc83t6phkfb2q8p94dtk8kr5fa8af3r.apps.googleusercontent.com --with-gdrive-client-secret=Hnzikj7HqdqsUYLru4jmFo1p",
                "make",
                "make distro-pack-install",
                "make cmd cmd='$(SRCDIR)/solenv/bin/assemble-flatpak.sh org.libreoffice.LibreOffice'",
                "printf '<?xml version=\"1.0\"?>\\n<oor:data xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:oor=\"http://openoffice.org/2001/registry\"><dependency file=\"main\"/><oor:component-data oor:name=\"Common\" oor:package=\"org.openoffice.Office\"><node oor:name=\"Misc\"><prop oor:name=\"UseOpenCL\"><value>false</value></prop></node></oor:component-data></oor:data>' >/app/libreoffice/share/registry/flatpak.xcd"
            ]
        }
    ],
    "add-extensions": {
        "org.libreoffice.LibreOffice.BundledExtension": {
            "directory": "libreoffice/share/extensions",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": true
        },
        "org.libreoffice.LibreOffice.Help": {
            "directory": "libreoffice/help",
            "bundle": true,
            "autodelete": true,
            "no-autodownload": true
        }
    },
    "finish-args": [
        "--share=network",
        "--share=ipc",
        "--socket=fallback-x11",
        "--socket=wayland",
        "--socket=pulseaudio",
        "--socket=cups",
        "--device=dri",
        "--filesystem=xdg-config/gtk-3.0",
        "--filesystem=xdg-config/fontconfig:ro",
        "--filesystem=xdg-run/gvfsd",
        "--filesystem=host",
        "--env=GIO_EXTRA_MODULES=/app/lib/gio/modules",
        "--env=JAVA_HOME=/app/jre",
        "--env=LIBO_FLATPAK=1",
        "--own-name=org.libreoffice.LibreOfficeIpc0",
        "--talk-name=org.gtk.vfs.*"
    ]
}
